<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Painel ETIT Móvel</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        body { font-family: Arial, sans-serif; background-color: #f2f2f2; text-align: center; }
        .container { max-width: 800px; margin: 50px auto; padding: 20px; background: white; border-radius: 10px; box-shadow: 0 0 10px rgba(0,0,0,0.1); }
        input, button { padding: 10px; margin: 10px; width: 80%; max-width: 300px; }
        .table-container { max-height: 300px; overflow-y: auto; margin-top: 20px; border: 1px solid #ddd; }
        table { width: 100%; border-collapse: collapse; }
        th, td { padding: 12px 15px; border: 1px solid #ddd; text-align: center; }
        th { background-color: #D52B1E; color: white; font-size: 16px; }
        tr:nth-child(even) { background-color: #f9f9f9; }
        .spinner { display: none; font-size: 18px; }
        .resultado { text-align: left; margin-top: 20px; font-size: 18px; }
        .resultado strong { font-weight: bold; }
        .status { padding: 10px; margin-top: 10px; font-size: 16px; color: white; border-radius: 5px; }
        .status.dentro { background-color: green; }
        .status.fora { background-color: red; }
    </style>
</head>
<body>
    <div class="container">
        <h2>Painel de Produtividade</h2>
        <input type="file" id="upload" accept=".xlsx">
        <input type="text" id="matricula" placeholder="Digite a matrícula" oninput="consultarETIT()">
        <div id="resultado" class="resultado"></div>
        <div class="spinner" id="spinner">⏳ Carregando...</div>
        <div class="table-container">
            <table id="tabelaDados"><thead><tr></tr></thead><tbody></tbody></table>
        </div>
    </div>
    <script>
        let dados = [];
        const setores = {
            "MÓVEL": ["J", "M", "O", "P", "Q", "R"],
            "EMPRESARIAL": ["E", "F", "J", "K", "L", "O", "P", "Q", "R"],
            "RESIDENCIAL": ["B", "C", "E", "F", "G", "H", "I", "L", "O", "P", "Q", "R"]
        };
        const analistas = {
            "MÓVEL": {
                "N6104793": "BRUNO MARIANO VILACA", "N5931955": "THIAGO DE SOUZA INACIO", "N6173067": "JULIANA RIBEIRO GALHÃO",
                "N6071740": "THIAGO BARBOZA DOS SANTOS", "N6172207": "CHARLES DOS SANTOS PAIVA", "F204763": "RODRIGO REIS DUARTE"
            },
            "EMPRESARIAL": {
                "N6088107": "LEANDRO GONÇALVES DE CARVALHO", "N5619600": "BRUNO COSTA BUCARD", "N0189105": "IGOR MARCELINO DE MARINS",
                "N5713690": "GABRIELA TAVARES DA SILVA", "N5802257": "MAGNO FERRAREZ DE MORAIS", "N5604148": "DANIEL MARCELO FELISBERTO OLIVEIRA",
                "F201714": "FERNANDA MESQUITA DE FREITAS", "N0125317": "ROBERTO SILVA DO NASCIMENTO", "N5819183": "RODRIGO PIRES BERNARDINO",
                "N5926003": "SUELLEN HERNANDEZ DA SILVA", "N5932064": "MONICA DA SILVA RODRIGUES"
            },
            "RESIDENCIAL": {
                "N0238475": "MARLEY MARQUES RIBEIRO", "N5923221": "KELLY PINHEIRO LIRA", "F160641": "JENNIFER MARIA ANDRADE SANTOS",
                "N5772086": "THIAGO PEREIRA DA SILVA", "N0239871": "LEONARDO FERREIRA LIMA DE ALMEIDA", "N5577565": "MARISTELLA MARCIA DOS SANTOS",
                "N5737414": "SANDRO DA SILVA CARVALHO", "N5972428": "CRISTIANE HERMOGENES DA SILVA", "N6173055": "JEFFERSON LUIS GONÇALVES COITINHO",
                "N5932090": "EVILÁZIO ANDRÉ DE MAGALHÃES GOMES PEREIRA", "N0255801": "ELBERTON ANICETO HENRIQUE", "N4014011": "ALAN MARINHO DIAS",
                "N5923996": "JULIO CESAR SANTOS SOARES"
            }
        };

        document.getElementById('upload').addEventListener('change', function(event) {
            const file = event.target.files[0];
            if (!file) return;
            document.getElementById("spinner").style.display = "block";
            const reader = new FileReader();
            reader.onload = function(e) {
                const data = new Uint8Array(e.target.result);
                const workbook = XLSX.read(data, { type: 'array' });
                const sheet = workbook.Sheets[workbook.SheetNames[0]];
                dados = XLSX.utils.sheet_to_json(sheet, { header: 1 });
                document.getElementById("spinner").style.display = "none";
                alert("Planilha carregada com sucesso!");
            };
            reader.readAsArrayBuffer(file);
        });

        function consultarETIT() {
            const matricula = document.getElementById('matricula').value.trim().toUpperCase();
            if (!matricula || !dados.length) return;

            let setorEncontrado = null;
            let nomeAnalista = "Nome não encontrado";
            let linhaAnalista = null;

            // Buscar o analista pelo número da matrícula
            for (let setor in analistas) {
                if (matricula in analistas[setor]) {
                    setorEncontrado = setor;
                    nomeAnalista = analistas[setor][matricula];
                    break;
                }
            }

            if (!setorEncontrado) return;

            // Identificar as colunas relevantes do setor
            let colunasSelecionadas = setores[setorEncontrado];
            let indiceColunas = colunasSelecionadas.map(letra => XLSX.utils.decode_col(letra));

            // Cabeçalhos das colunas com descrições legíveis
            const cabeçalhos = {
                "J": "Indicador 1",
                "M": "Indicador 2",
                "O": "Indicador 3",
                "P": "Indicador 4",
                "Q": "Indicador 5",
                "R": "Indicador 6",
                "E": "Indicador 7",
                "F": "Indicador 8",
                "K": "Indicador 9",
                "L": "Indicador 10",
                "B": "Indicador 11",
                "C": "Indicador 12",
                "G": "Indicador 13",
                "H": "Indicador 14",
                "I": "Indicador 15"
            };

            // Criar a tabela HTML com os cabeçalhos descritivos
            let tabelaHTML = "<tr>" + colunasSelecionadas.map(col => `<th>${cabeçalhos[col]}</th>`).join("") + "</tr>";

            // Procurar os dados do analista consultado e apenas exibir esses dados
            dados.forEach(row => {
                if (row[0] === matricula) {  // Verifica se a linha corresponde à matrícula consultada
                    let linha = "<tr>";
                    let dadosLinha = [];
                    
                    // Obter os dados das colunas selecionadas para aquela matrícula
                    let valoresColunas = indiceColunas.map(i => row[i] || "");

                    // Exibir os valores das colunas
                    dadosLinha = valoresColunas.map(i => `<td>${i}</td>`);
                    linha += dadosLinha.join("") + "</tr>";
                    tabelaHTML += linha;
                }
            });

            // Exibir a tabela apenas com os dados do analista
            document.getElementById("resultado").innerHTML = `<p><strong>Nome:</strong> ${nomeAnalista}</p><p><strong>Setor:</strong> ${setorEncontrado}</p>`;
            document.getElementById("tabelaDados").innerHTML = tabelaHTML;
        }
    </script>
</body>
</html>
