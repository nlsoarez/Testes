<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Painel de Produtividade</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        body { font-family: Arial, sans-serif; background-color: #f2f2f2; text-align: center; }
        .container { max-width: 900px; margin: 50px auto; padding: 20px; background: white; border-radius: 10px; box-shadow: 0 0 10px rgba(0,0,0,0.1); }
        input, button { padding: 10px; margin: 10px; }
        .table-container { max-height: 400px; overflow-y: auto; margin-top: 20px; border: 1px solid #ddd; }
        table { width: 100%; border-collapse: collapse; }
        th, td { padding: 8px; border: 1px solid #ddd; }
        th { background-color: #333; color: white; }
        .setor { font-weight: bold; font-size: 18px; margin-top: 20px; color: #D52B1E; }
    </style>
</head>
<body>
    <div class="container">
        <h2>Painel de Produtividade por Setor</h2>
        <input type="file" id="upload" accept=".xlsx">
        <input type="text" id="matricula" placeholder="Digite a matrícula" oninput="consultarAnalista()">
        <div id="output"></div>
    </div>
    <script>
        let dados = [];
        const setores = {
            "MÓVEL": ["N6104793", "N5931955", "N6173067", "N6071740", "N6172207", "F204763"],
            "EMPRESARIAL": ["N6088107", "N5619600", "N0189105", "N5713690", "N5802257", "N5604148", "F201714", "N0125317", "N5819183", "N5926003", "N5932064"],
            "RESIDENCIAL": ["N0238475", "N5923221", "F160641", "N5772086", "N0239871", "N5577565", "N5737414", "N5972428", "N6173055", "N5932090", "N0255801", "N4014011", "N5923996"]
        };

        document.getElementById('upload').addEventListener('change', function(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                const data = new Uint8Array(e.target.result);
                const workbook = XLSX.read(data, { type: 'array' });
                const sheet = workbook.Sheets[workbook.SheetNames[0]];
                dados = XLSX.utils.sheet_to_json(sheet, { header: 1 });
            };
            reader.readAsArrayBuffer(file);
        });

        function consultarAnalista() {
            const matricula = document.getElementById('matricula').value.trim().toUpperCase();
            if (!dados.length || !matricula) return;

            let setorEncontrado = "";
            for (const [setor, matriculas] of Object.entries(setores)) {
                if (matriculas.includes(matricula)) {
                    setorEncontrado = setor;
                    break;
                }
            }

            if (!setorEncontrado) {
                document.getElementById("output").innerHTML = "Matrícula não encontrada.";
                return;
            }

            let resultados = `<h3 class='setor'>${setorEncontrado}</h3>`;
            let headers = dados[0];
            let totalAnalista = 0;
            let totalSetor = 0;
            let contadorSetor = 0;
            
            dados.slice(1).forEach(row => {
                let matriculaRow = row[0]?.toString().trim();
                if (matriculaRow === matricula) {
                    totalAnalista = row[headers.length - 1];
                    resultados += `<p><strong>Matrícula:</strong> ${matriculaRow} | <strong>Total:</strong> ${totalAnalista}</p>`;
                }
                if (setores[setorEncontrado].includes(matriculaRow)) {
                    totalSetor += row[headers.length - 1];
                    contadorSetor++;
                }
            });

            let mediaSetor = contadorSetor > 0 ? (totalSetor / contadorSetor).toFixed(2) : 0;
            let comparacao = totalAnalista >= mediaSetor ? "Acima da média" : "Abaixo da média";
            resultados += `<p><strong>Média do Setor:</strong> ${mediaSetor} | <strong>Comparação:</strong> ${comparacao}</p>`;

            document.getElementById("output").innerHTML = resultados;
        }
    </script>
</body>
</html>
